<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MovieMapper.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SoMovie</a> &gt; <a href="index.source.html" class="el_package">com.louisfn.somovie.data.mapper</a> &gt; <span class="el_source">MovieMapper.kt</span></div><h1>MovieMapper.kt</h1><pre class="source lang-java linenums">package com.louisfn.somovie.data.mapper

import androidx.annotation.AnyThread
import com.louisfn.somovie.core.common.provider.DateTimeProvider
import com.louisfn.somovie.data.database.entity.CompanyEntity
import com.louisfn.somovie.data.database.entity.GenreEntity
import com.louisfn.somovie.data.database.entity.MovieEntity
import com.louisfn.somovie.data.database.entity.MovieProductionCountryEntity
import com.louisfn.somovie.data.database.relation.MovieWithRelations
import com.louisfn.somovie.data.network.response.MovieAccountStateResponse
import com.louisfn.somovie.data.network.response.MovieDetailsResponse
import com.louisfn.somovie.data.network.response.MovieGenreResponse
import com.louisfn.somovie.data.network.response.MovieResponse
import com.louisfn.somovie.domain.model.BackdropPath
import com.louisfn.somovie.domain.model.Movie
import com.louisfn.somovie.domain.model.PosterPath
import javax.inject.Inject

<span class="fc" id="L19">class MovieMapper @Inject constructor(</span>
<span class="fc" id="L20">    private val genreMapper: GenreMapper,</span>
<span class="fc" id="L21">    private val countryMapper: CountryMapper,</span>
<span class="fc" id="L22">    private val companyMapper: CompanyMapper,</span>
<span class="fc" id="L23">    private val dateTimeProvider: DateTimeProvider</span>
) {

    //region Map entity to domain

<span class="fc" id="L28">    fun mapToDomain(entities: List&lt;MovieEntity&gt;): List&lt;Movie&gt; = entities.map(::mapToDomain)</span>

    fun mapToDomain(entity: MovieEntity): Movie =
<span class="fc" id="L31">        mapToDomain(</span>
<span class="fc" id="L32">            movie = entity,</span>
<span class="fc" id="L33">            countries = emptyList(),</span>
<span class="fc" id="L34">            companies = emptyList(),</span>
<span class="fc" id="L35">            genres = emptyList()</span>
<span class="fc" id="L36">        )</span>

    fun mapToDomain(entity: MovieWithRelations): Movie =
<span class="nc" id="L39">        mapToDomain(</span>
<span class="nc" id="L40">            movie = entity.movie,</span>
<span class="nc" id="L41">            countries = entity.productionCountries,</span>
<span class="nc" id="L42">            companies = entity.productionCompanies,</span>
<span class="nc" id="L43">            genres = entity.genres</span>
<span class="nc" id="L44">        )</span>

    private fun mapToDomain(
        movie: MovieEntity,
        countries: List&lt;MovieProductionCountryEntity&gt;,
        companies: List&lt;CompanyEntity&gt;,
        genres: List&lt;GenreEntity&gt;
<span class="fc" id="L51">    ) = Movie(</span>
<span class="fc" id="L52">        id = movie.id,</span>
<span class="fc" id="L53">        title = movie.title,</span>
<span class="fc" id="L54">        originalTitle = movie.originalTitle,</span>
<span class="fc" id="L55">        originalLanguage = movie.originalLanguage,</span>
<span class="fc" id="L56">        overview = movie.overview,</span>
<span class="fc" id="L57">        releaseDate = movie.releaseDate,</span>
<span class="fc" id="L58">        voteAverage = movie.voteAverage,</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        posterPath = movie.posterPath?.let(::PosterPath),</span>
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">        backdropPath = movie.backdropPath?.let(::BackdropPath),</span>
<span class="fc" id="L61">        watchlist = movie.watchlist,</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">        details = movie.details?.let { details -&gt;</span>
<span class="nc" id="L63">            Movie.Details(</span>
<span class="nc" id="L64">                tagline = details.tagline,</span>
<span class="nc" id="L65">                runtime = details.runtime,</span>
<span class="nc" id="L66">                popularity = details.popularity,</span>
<span class="nc" id="L67">                budget = details.budget,</span>
<span class="nc" id="L68">                revenue = details.revenue,</span>
<span class="nc" id="L69">                voteCount = details.voteCount,</span>
<span class="nc" id="L70">                productionCountries = countryMapper.mapToDomain(countries),</span>
<span class="nc" id="L71">                productionCompanies = companyMapper.mapToDomain(companies),</span>
<span class="nc" id="L72">                genres = genreMapper.mapToDomain(genres)</span>
            )
        }
<span class="fc" id="L75">    )</span>

    //endregion

    //region Map response to entity

    fun mapToEntity(responses: List&lt;MovieResponse&gt;, fromWatchlist: Boolean): List&lt;MovieEntity&gt; =
<span class="fc" id="L82">        responses.map { mapToEntity(it, fromWatchlist) }</span>

    fun mapToEntity(
        detailsResponse: MovieDetailsResponse,
        accountStateResponse: MovieAccountStateResponse?
    ): MovieWithRelations =
<span class="nc" id="L88">        MovieWithRelations(</span>
<span class="nc" id="L89">            movie = MovieEntity(</span>
<span class="nc" id="L90">                id = detailsResponse.id,</span>
<span class="nc" id="L91">                title = detailsResponse.title,</span>
<span class="nc" id="L92">                originalTitle = detailsResponse.originalTitle,</span>
<span class="nc" id="L93">                originalLanguage = detailsResponse.originalLanguage,</span>
<span class="nc" id="L94">                overview = detailsResponse.overview,</span>
<span class="nc" id="L95">                releaseDate = detailsResponse.releaseDate,</span>
<span class="nc" id="L96">                posterPath = detailsResponse.posterPath,</span>
<span class="nc" id="L97">                backdropPath = detailsResponse.backdropPath,</span>
<span class="nc" id="L98">                voteAverage = detailsResponse.voteAverage,</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                watchlist = accountStateResponse?.watchlist,</span>
<span class="nc" id="L100">                updatedAt = dateTimeProvider.now(),</span>
<span class="nc" id="L101">                detailsUpdatedAt = dateTimeProvider.now(),</span>
<span class="nc" id="L102">                details = MovieEntity.Details(</span>
<span class="nc" id="L103">                    tagline = detailsResponse.tagline,</span>
<span class="nc" id="L104">                    runtime = detailsResponse.runtime,</span>
<span class="nc" id="L105">                    popularity = detailsResponse.popularity,</span>
<span class="nc" id="L106">                    revenue = detailsResponse.revenue,</span>
<span class="nc" id="L107">                    budget = detailsResponse.budget,</span>
<span class="nc" id="L108">                    voteCount = detailsResponse.voteCount</span>
                )
            ),
<span class="nc" id="L111">            genres = detailsResponse.genres.map(::mapToEntity),</span>
<span class="nc" id="L112">            productionCompanies = companyMapper.mapToEntity(detailsResponse.productionCompanies),</span>
<span class="nc" id="L113">            productionCountries = countryMapper.mapToEntity(</span>
<span class="nc" id="L114">                detailsResponse.id,</span>
<span class="nc" id="L115">                detailsResponse.productionCountries</span>
            )
<span class="nc" id="L117">        )</span>

    @AnyThread
<span class="fc" id="L120">    private fun mapToEntity(response: MovieResponse, fromWatchlist: Boolean) = MovieEntity(</span>
<span class="fc" id="L121">        id = response.id,</span>
<span class="fc" id="L122">        title = response.title,</span>
<span class="fc" id="L123">        originalTitle = response.originalTitle,</span>
<span class="fc" id="L124">        originalLanguage = response.originalLanguage,</span>
<span class="fc" id="L125">        overview = response.overview,</span>
<span class="fc" id="L126">        releaseDate = response.releaseDate,</span>
<span class="fc" id="L127">        posterPath = response.posterPath,</span>
<span class="fc" id="L128">        backdropPath = response.backdropPath,</span>
<span class="fc" id="L129">        voteAverage = response.voteAverage,</span>
<span class="fc" id="L130">        details = null,</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">        watchlist = true.takeIf { fromWatchlist },</span>
<span class="fc" id="L132">        updatedAt = dateTimeProvider.now(),</span>
<span class="fc" id="L133">        detailsUpdatedAt = null</span>
<span class="fc" id="L134">    )</span>

<span class="nc" id="L136">    private fun mapToEntity(response: MovieGenreResponse) = GenreEntity(</span>
<span class="nc" id="L137">        id = response.id,</span>
<span class="nc" id="L138">        name = response.name</span>
<span class="nc" id="L139">    )</span>

    //endregion

    //region Map response to domain

    @JvmName(&quot;mapToResponseToDomain&quot;)
    fun mapToDomain(responses: List&lt;MovieResponse&gt;): List&lt;Movie&gt; =
<span class="nc" id="L147">        responses.map(::mapToDomain)</span>

    @AnyThread
<span class="nc" id="L150">    private fun mapToDomain(response: MovieResponse) = Movie(</span>
<span class="nc" id="L151">        id = response.id,</span>
<span class="nc" id="L152">        title = response.title,</span>
<span class="nc" id="L153">        originalTitle = response.originalTitle,</span>
<span class="nc" id="L154">        originalLanguage = response.originalLanguage,</span>
<span class="nc" id="L155">        overview = response.overview,</span>
<span class="nc" id="L156">        releaseDate = response.releaseDate,</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        posterPath = response.posterPath?.let(::PosterPath),</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">        backdropPath = response.posterPath?.let(::BackdropPath),</span>
<span class="nc" id="L159">        voteAverage = response.voteAverage,</span>
<span class="nc" id="L160">        watchlist = null,</span>
<span class="nc" id="L161">        details = null</span>
<span class="nc" id="L162">    )</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>